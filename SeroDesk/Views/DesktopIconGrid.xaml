<UserControl x:Class="SeroDesk.Views.DesktopIconGrid"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SeroDesk.Views"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             AllowDrop="True"
             Drop="Grid_Drop"
             DragOver="Grid_DragOver">
    
    <UserControl.Resources>
        <!-- Launchpad-Style Icon Template -->
        <DataTemplate x:Key="IconTemplate">
            <Button Width="120" Height="120"
                    Margin="10"
                    Background="Transparent"
                    BorderThickness="0"
                    Click="IconButton_Click"
                    Tag="{Binding}"
                    Cursor="Hand"
                    RenderTransformOrigin="0.5,0.5"
                    MouseDoubleClick="IconButton_DoubleClick"
                    AllowDrop="True">
                <Button.RenderTransform>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Button.RenderTransform>
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Grid Background="Transparent">
                            <ContentPresenter/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.9" ScaleY="0.9"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.05" ScaleY="1.05"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
                
                <Grid>
                    <!-- Icon Background -->
                    <Border Background="#40FFFFFF"
                           CornerRadius="18"
                           Width="80" Height="80"
                           VerticalAlignment="Top">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="8" Opacity="0.2"/>
                        </Border.Effect>
                        
                        <!-- App Icon -->
                        <Image Source="{Binding IconImage}"
                               Width="56" Height="56">
                            <Image.Clip>
                                <RectangleGeometry Rect="0,0,56,56" 
                                                 RadiusX="12" RadiusY="12"/>
                            </Image.Clip>
                        </Image>
                    </Border>
                    
                    <!-- App Name -->
                    <TextBlock Text="{Binding Name}"
                             Foreground="White"
                             FontSize="11"
                             FontWeight="Medium"
                             TextAlignment="Center"
                             TextWrapping="Wrap"
                             VerticalAlignment="Bottom"
                             Margin="2,0,2,5"
                             MaxWidth="110"
                             MaxHeight="30"
                             TextTrimming="CharacterEllipsis"/>
                             
                    <!-- Selection Highlight -->
                    <Border Background="#40007AFF"
                            CornerRadius="18"
                            Width="80" Height="80"
                            VerticalAlignment="Top"
                            Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}"
                            IsHitTestVisible="False"/>
                </Grid>
            </Button>
        </DataTemplate>
    </UserControl.Resources>
    
    <Grid>
        <!-- Icons Container with Launchpad-style layout -->
        <ScrollViewer VerticalScrollBarVisibility="Hidden"
                      HorizontalScrollBarVisibility="Disabled"
                      PanningMode="VerticalOnly"
                      Margin="120,40,120,120">
            <ItemsControl x:Name="IconsControl"
                          ItemsSource="{Binding DesktopIcons}"
                          ItemTemplate="{StaticResource IconTemplate}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <!-- WrapPanel zeigt nur vorhandene Icons ohne leere Boxen -->
                        <WrapPanel Orientation="Horizontal"
                                  ItemWidth="140"
                                  ItemHeight="140"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Top"
                                  MaxWidth="1120"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <EventSetter Event="MouseLeftButtonDown" Handler="Icon_MouseLeftButtonDown"/>
                        <EventSetter Event="MouseLeftButtonUp" Handler="Icon_MouseLeftButtonUp"/>
                        <EventSetter Event="MouseMove" Handler="Icon_MouseMove"/>
                        <EventSetter Event="TouchDown" Handler="Icon_TouchDown"/>
                        <EventSetter Event="TouchUp" Handler="Icon_TouchUp"/>
                        <EventSetter Event="TouchMove" Handler="Icon_TouchMove"/>
                    </Style>
                </ItemsControl.ItemContainerStyle>
            </ItemsControl>
        </ScrollViewer>
        
        <!-- Drag Visual -->
        <Canvas x:Name="DragCanvas" 
                IsHitTestVisible="False"
                Visibility="Collapsed">
            <Border x:Name="DragVisual"
                    Background="#40007AFF"
                    CornerRadius="18"
                    Width="120"
                    Height="120">
                <Grid>
                    <!-- Icon Background -->
                    <Border Background="#60FFFFFF"
                           CornerRadius="18"
                           Width="80" Height="80"
                           VerticalAlignment="Top"
                           Opacity="0.8">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="8" Opacity="0.2"/>
                        </Border.Effect>
                        
                        <!-- App Icon -->
                        <Image x:Name="DragIcon"
                               Width="56" Height="56">
                            <Image.Clip>
                                <RectangleGeometry Rect="0,0,56,56" 
                                                 RadiusX="12" RadiusY="12"/>
                            </Image.Clip>
                        </Image>
                    </Border>
                    
                    <!-- App Name -->
                    <TextBlock x:Name="DragText"
                             Foreground="White"
                             FontSize="11"
                             FontWeight="Medium"
                             TextAlignment="Center"
                             VerticalAlignment="Bottom"
                             Margin="2,0,2,5"
                             MaxWidth="110"/>
                </Grid>
            </Border>
        </Canvas>
    </Grid>
</UserControl>