<UserControl x:Class="SeroDesk.Views.SeroDock"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             Height="90"
             d:DesignWidth="1920">
    
    <Grid>
        <!-- iOS/macOS Style Dock with Glassmorphism -->
        <Grid VerticalAlignment="Bottom" Margin="0,0,0,15">
            <!-- Dock Background - Simple Glassmorphism (NO BLUR) -->
            <Border x:Name="DockBackground"
                    Height="70"
                    VerticalAlignment="Bottom"
                    HorizontalAlignment="Center"
                    CornerRadius="25"
                    MinWidth="400">
                <!-- Multi-layer glassmorphism effect with enhanced visibility -->
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#C0F0F0F0" Offset="0"/>
                        <GradientStop Color="#B0E8E8E8" Offset="0.5"/>
                        <GradientStop Color="#C5F0F0F0" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
                
                <!-- Add subtle inner border for glass effect -->
                <Border.BorderBrush>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#D0FFFFFF" Offset="0"/>
                        <GradientStop Color="#A0FFFFFF" Offset="1"/>
                    </LinearGradientBrush>
                </Border.BorderBrush>
                <Border.BorderThickness>1.5</Border.BorderThickness>
                
                        <!-- Dock Items Container -->
                        <Grid HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Margin="12,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/> <!-- Home Button -->
                                <ColumnDefinition Width="Auto"/> <!-- Separator -->
                                <ColumnDefinition Width="Auto"/> <!-- Running Apps -->
                                <ColumnDefinition Width="Auto"/> <!-- Separator -->
                                <ColumnDefinition Width="Auto"/> <!-- Explorer -->
                                <ColumnDefinition Width="*"/>    <!-- Spacer -->
                                <ColumnDefinition Width="Auto"/> <!-- Recycle Bin -->
                            </Grid.ColumnDefinitions>
                    
                    <!-- Home Button (Show Desktop) -->
                    <Button Grid.Column="0"
                            x:Name="HomeButton"
                            Width="40" Height="40"
                            Margin="4,0"
                            Background="Transparent"
                            BorderThickness="0"
                            Click="HomeButton_Click"
                            ToolTip="Show Desktop"
                            Style="{StaticResource DockIconStyle}">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Grid>
                                    <Border CornerRadius="8" ClipToBounds="True">
                                        <Border Background="#40FFFFFF" CornerRadius="8">
                                            <Grid>
                                                <!-- Home Icon -->
                                                <Path Data="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" 
                                                      Fill="White" 
                                                      Stretch="Uniform"
                                                      Width="24" Height="24"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </Border>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- Separator 1 -->
                    <Rectangle Grid.Column="1"
                               Width="1" Height="30"
                               Fill="#60FFFFFF"
                               Margin="8,0"/>
                    
                    <!-- Running Apps -->
                    <ItemsControl Grid.Column="2"
                                x:Name="RunningAppsControl"
                                ItemsSource="{Binding RunningApplications}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Width="40" Height="40"
                                        Margin="4,0"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Style="{StaticResource DockIconStyle}"
                                        Click="DockIcon_Click"
                                        MouseEnter="DockIcon_MouseEnter"
                                        MouseLeave="DockIcon_MouseLeave"
                                        Tag="{Binding}"
                                        ToolTip="{Binding Title}">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Grid>
                                                <!-- App Icon with rounded corners - smaller size -->
                                                <Border CornerRadius="8" ClipToBounds="True">
                                                    <Image x:Name="AppIcon"
                                                           Source="{Binding Icon, Converter={StaticResource IconToImageSourceConverter}}"
                                                           Width="40" Height="40"
                                                           RenderOptions.BitmapScalingMode="HighQuality"
                                                           RenderTransformOrigin="0.5,0.5">
                                                        <Image.RenderTransform>
                                                            <ScaleTransform x:Name="IconScale" 
                                                                          ScaleX="1" ScaleY="1"/>
                                                        </Image.RenderTransform>
                                                    </Image>
                                                </Border>
                                                
                                                <!-- Running Indicator Dot -->
                                                <Ellipse x:Name="RunningDot"
                                                        Width="3" Height="3"
                                                        Fill="#333333"
                                                        VerticalAlignment="Bottom"
                                                        HorizontalAlignment="Center"
                                                        Margin="0,0,0,-5"
                                                        Visibility="{Binding IsRunning, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            </Grid>
                                            
                                            <ControlTemplate.Triggers>
                                                <!-- Hover Animation -->
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Trigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetName="IconScale"
                                                                               Storyboard.TargetProperty="ScaleX"
                                                                               To="1.1" Duration="0:0:0.12">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                                <DoubleAnimation Storyboard.TargetName="IconScale"
                                                                               Storyboard.TargetProperty="ScaleY"
                                                                               To="1.1" Duration="0:0:0.12">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.EnterActions>
                                                    <Trigger.ExitActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetName="IconScale"
                                                                               Storyboard.TargetProperty="ScaleX"
                                                                               To="1.0" Duration="0:0:0.12">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                                <DoubleAnimation Storyboard.TargetName="IconScale"
                                                                               Storyboard.TargetProperty="ScaleY"
                                                                               To="1.0" Duration="0:0:0.12">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.ExitActions>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Separator after running apps -->
                    <Rectangle Grid.Column="1" 
                              Width="1" Height="28"
                              Fill="#33000000"
                              Margin="6,0"
                              VerticalAlignment="Center"/>
                    
                    <!-- Finder (File Explorer) - System Icon -->
                    <Button Grid.Column="3"
                            Width="40" Height="40"
                            Margin="4,0"
                            Background="Transparent"
                            BorderThickness="0"
                            Style="{StaticResource DockIconStyle}"
                            Click="FinderIcon_Click"
                            ToolTip="File Explorer">
                        <Border CornerRadius="8" ClipToBounds="True">
                            <Image x:Name="ExplorerIcon"
                                   Width="40" Height="40"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   RenderTransformOrigin="0.5,0.5">
                                <Image.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </Image.RenderTransform>
                            </Image>
                        </Border>
                        <Button.Triggers>
                            <EventTrigger RoutedEvent="MouseEnter">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ExplorerIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                       To="1.1" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="ExplorerIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                       To="1.1" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <EventTrigger RoutedEvent="MouseLeave">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ExplorerIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                       To="1.0" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="ExplorerIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                       To="1.0" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Button.Triggers>
                    </Button>
                    
                    <!-- Spacer -->
                    <Border Grid.Column="4" Width="10"/>
                    
                    <!-- Recycle Bin (Always on the right) - System Icon -->
                    <Button Grid.Column="5"
                            Width="40" Height="40"
                            Margin="4,0"
                            Background="Transparent"
                            BorderThickness="0"
                            Style="{StaticResource DockIconStyle}"
                            Click="TrashIcon_Click"
                            ToolTip="Recycle Bin">
                        <Border CornerRadius="8" ClipToBounds="True">
                            <Image x:Name="RecycleBinIcon"
                                   Width="40" Height="40"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   RenderTransformOrigin="0.5,0.5">
                                <Image.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </Image.RenderTransform>
                            </Image>
                        </Border>
                        <Button.Triggers>
                            <EventTrigger RoutedEvent="MouseEnter">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="RecycleBinIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                       To="1.1" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="RecycleBinIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                       To="1.1" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <EventTrigger RoutedEvent="MouseLeave">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="RecycleBinIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                       To="1.0" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="RecycleBinIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                       To="1.0" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Button.Triggers>
                    </Button>
                        </Grid>
            </Border>
            
            <!-- Dock Shadow for depth -->
            <Border x:Name="DockShadow"
                    Height="60"
                    VerticalAlignment="Bottom"
                    HorizontalAlignment="Center"
                    CornerRadius="16"
                    MinWidth="320"
                    Margin="0,0,0,6"
                    Panel.ZIndex="-1">
                <Border.Effect>
                    <DropShadowEffect Color="Black" 
                                      BlurRadius="25" 
                                      ShadowDepth="4" 
                                      Opacity="0.4"/>
                </Border.Effect>
            </Border>
        </Grid>
        
        <!-- Dock Hidden State Indicator -->
        <Border x:Name="DockIndicator"
                Width="60" Height="4"
                Background="#40FFFFFF"
                CornerRadius="2"
                VerticalAlignment="Bottom"
                HorizontalAlignment="Center"
                Margin="0,0,0,8"
                Visibility="Collapsed"/>
    </Grid>
</UserControl>