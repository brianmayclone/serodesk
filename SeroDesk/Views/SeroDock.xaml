<UserControl x:Class="SeroDesk.Views.SeroDock"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             Height="90"
             d:DesignWidth="1920">
    
    <Grid>
        <!-- iOS/macOS Style Dock with Glassmorphism -->
        <Grid VerticalAlignment="Bottom" Margin="0,0,0,15">
            <!-- Dock Background - Simple Glassmorphism (NO BLUR) -->
            <Border x:Name="DockBackground"
                    Height="70"
                    VerticalAlignment="Bottom"
                    HorizontalAlignment="Center"
                    CornerRadius="25"
                    MinWidth="400">
                <!-- Multi-layer glassmorphism effect with enhanced visibility -->
                <Border.Background>
                    <StaticResource ResourceKey="DockBackgroundBrush"/>
                </Border.Background>
                
                <!-- Add subtle inner border for glass effect -->
                <Border.BorderBrush>
                    <StaticResource ResourceKey="DockBorderBrush"/>
                </Border.BorderBrush>
                <Border.BorderThickness>1.5</Border.BorderThickness>
                
                        <!-- Dock Items Container -->
                        <Grid HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Margin="12,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/> <!-- Home Button -->
                                <ColumnDefinition Width="Auto"/> <!-- Separator -->
                                <ColumnDefinition Width="Auto"/> <!-- Running Apps -->
                                <ColumnDefinition Width="Auto"/> <!-- Separator -->
                                <ColumnDefinition Width="Auto"/> <!-- Explorer -->
                                <ColumnDefinition Width="*"/>    <!-- Spacer -->
                                <ColumnDefinition Width="Auto"/> <!-- Settings -->
                                <ColumnDefinition Width="Auto"/> <!-- Recycle Bin -->
                            </Grid.ColumnDefinitions>
                    
                    <!-- Home Button (Show Desktop) -->
                    <Button Grid.Column="0"
                            x:Name="HomeButton"
                            Width="40" Height="40"
                            Margin="4,0"
                            Background="Transparent"
                            BorderThickness="0"
                            Click="HomeButton_Click"
                            ToolTip="Show Desktop"
                            Style="{StaticResource DockIconStyle}">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Grid>
                                    <Border CornerRadius="8" ClipToBounds="True">
                                        <Border Background="{StaticResource DockIconBackgroundBrush}" CornerRadius="8">
                                            <Grid>
                                                <!-- Home Icon -->
                                                <Path Data="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" 
                                                      Fill="{StaticResource DockIconForegroundBrush}" 
                                                      Stretch="Uniform"
                                                      Width="24" Height="24"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </Border>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- Separator 1 -->
                    <Rectangle Grid.Column="1"
                               Width="1" Height="30"
                               Fill="{StaticResource DockSeparatorBrush}"
                               Margin="8,0"/>
                    
                    <!-- Running Apps -->
                    <ItemsControl Grid.Column="2"
                                x:Name="RunningAppsControl"
                                ItemsSource="{Binding RunningApplications}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Width="40" Height="40"
                                        Margin="4,0"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Style="{StaticResource DockIconStyle}"
                                        Click="DockIcon_Click"
                                        MouseEnter="DockIcon_MouseEnter"
                                        MouseLeave="DockIcon_MouseLeave"
                                        MouseRightButtonUp="DockIcon_RightClick"
                                        Tag="{Binding}"
                                        ToolTip="{Binding Title}">
                                    <Button.ContextMenu>
                                        <ContextMenu x:Name="DockIconContextMenu">
                                            <MenuItem Header="Open" Click="ContextMenu_Open"/>
                                            <MenuItem Header="Close Window" Click="ContextMenu_Close"/>
                                            <Separator/>
                                            <MenuItem Header="Unpin from Dock" Click="ContextMenu_UnpinFromDock"/>
                                            <Separator/>
                                            <MenuItem Header="Open File Location" Click="ContextMenu_OpenFileLocation"/>
                                            <MenuItem Header="Properties" Click="ContextMenu_Properties"/>
                                        </ContextMenu>
                                    </Button.ContextMenu>
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Grid>
                                                <!-- App Icon with rounded corners - smaller size -->
                                                <Border CornerRadius="8" ClipToBounds="True">
                                                    <Image x:Name="AppIcon"
                                                           Source="{Binding Icon, Converter={StaticResource IconToImageSourceConverter}}"
                                                           Width="40" Height="40"
                                                           RenderOptions.BitmapScalingMode="HighQuality"
                                                           RenderTransformOrigin="0.5,0.5">
                                                        <Image.RenderTransform>
                                                            <ScaleTransform x:Name="IconScale" 
                                                                          ScaleX="1" ScaleY="1"/>
                                                        </Image.RenderTransform>
                                                    </Image>
                                                </Border>
                                                
                                                <!-- Running Indicator Dot -->
                                                <Ellipse x:Name="RunningDot"
                                                        Width="3" Height="3"
                                                        Fill="#333333"
                                                        VerticalAlignment="Bottom"
                                                        HorizontalAlignment="Center"
                                                        Margin="0,0,0,-5"
                                                        Visibility="{Binding IsRunning, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            </Grid>
                                            
                                            <ControlTemplate.Triggers>
                                                <!-- Hover Animation -->
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Trigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetName="IconScale"
                                                                               Storyboard.TargetProperty="ScaleX"
                                                                               To="1.1" Duration="0:0:0.12">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                                <DoubleAnimation Storyboard.TargetName="IconScale"
                                                                               Storyboard.TargetProperty="ScaleY"
                                                                               To="1.1" Duration="0:0:0.12">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.EnterActions>
                                                    <Trigger.ExitActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetName="IconScale"
                                                                               Storyboard.TargetProperty="ScaleX"
                                                                               To="1.0" Duration="0:0:0.12">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                                <DoubleAnimation Storyboard.TargetName="IconScale"
                                                                               Storyboard.TargetProperty="ScaleY"
                                                                               To="1.0" Duration="0:0:0.12">
                                                                    <DoubleAnimation.EasingFunction>
                                                                        <CubicEase EasingMode="EaseOut"/>
                                                                    </DoubleAnimation.EasingFunction>
                                                                </DoubleAnimation>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.ExitActions>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Separator after running apps -->
                    <Rectangle Grid.Column="1" 
                              Width="1" Height="28"
                              Fill="#33000000"
                              Margin="6,0"
                              VerticalAlignment="Center"/>
                    
                    <!-- Finder (File Explorer) - System Icon -->
                    <Button Grid.Column="3"
                            Width="40" Height="40"
                            Margin="4,0"
                            Background="Transparent"
                            BorderThickness="0"
                            Style="{StaticResource DockIconStyle}"
                            Click="FinderIcon_Click"
                            ToolTip="File Explorer">
                        <Border CornerRadius="8" ClipToBounds="True">
                            <Image x:Name="ExplorerIcon"
                                   Width="40" Height="40"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   RenderTransformOrigin="0.5,0.5">
                                <Image.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </Image.RenderTransform>
                            </Image>
                        </Border>
                        <Button.Triggers>
                            <EventTrigger RoutedEvent="MouseEnter">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ExplorerIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                       To="1.1" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="ExplorerIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                       To="1.1" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <EventTrigger RoutedEvent="MouseLeave">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ExplorerIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                       To="1.0" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="ExplorerIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                       To="1.0" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Button.Triggers>
                    </Button>
                    
                    <!-- Spacer -->
                    <Border Grid.Column="5" Width="10"/>
                    
                    <!-- Settings Button -->
                    <Button Grid.Column="6"
                            x:Name="SettingsButton"
                            Width="40" Height="40"
                            Margin="4,0"
                            Background="Transparent"
                            BorderThickness="0"
                            Style="{StaticResource DockIconStyle}"
                            Click="SettingsButton_Click"
                            ToolTip="Settings">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Grid>
                                    <Border CornerRadius="8" ClipToBounds="True">
                                        <Border Background="{StaticResource DockIconBackgroundBrush}" CornerRadius="8">
                                            <Grid>
                                                <!-- Settings Icon -->
                                                <Path Data="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" 
                                                      Fill="{StaticResource DockIconForegroundBrush}" 
                                                      Stretch="Uniform"
                                                      Width="24" Height="24"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"
                                                      RenderTransformOrigin="0.5,0.5">
                                                    <Path.RenderTransform>
                                                        <ScaleTransform x:Name="SettingsIconScale" 
                                                                      ScaleX="1" ScaleY="1"/>
                                                    </Path.RenderTransform>
                                                </Path>
                                            </Grid>
                                        </Border>
                                    </Border>
                                </Grid>
                                <ControlTemplate.Triggers>
                                    <!-- Hover Animation -->
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Trigger.EnterActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="SettingsIconScale"
                                                                   Storyboard.TargetProperty="ScaleX"
                                                                   To="1.1" Duration="0:0:0.12">
                                                        <DoubleAnimation.EasingFunction>
                                                            <CubicEase EasingMode="EaseOut"/>
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                    <DoubleAnimation Storyboard.TargetName="SettingsIconScale"
                                                                   Storyboard.TargetProperty="ScaleY"
                                                                   To="1.1" Duration="0:0:0.12">
                                                        <DoubleAnimation.EasingFunction>
                                                            <CubicEase EasingMode="EaseOut"/>
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </Trigger.EnterActions>
                                        <Trigger.ExitActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="SettingsIconScale"
                                                                   Storyboard.TargetProperty="ScaleX"
                                                                   To="1.0" Duration="0:0:0.12">
                                                        <DoubleAnimation.EasingFunction>
                                                            <CubicEase EasingMode="EaseOut"/>
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                    <DoubleAnimation Storyboard.TargetName="SettingsIconScale"
                                                                   Storyboard.TargetProperty="ScaleY"
                                                                   To="1.0" Duration="0:0:0.12">
                                                        <DoubleAnimation.EasingFunction>
                                                            <CubicEase EasingMode="EaseOut"/>
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </Trigger.ExitActions>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- Recycle Bin (Always on the right) - System Icon -->
                    <Button Grid.Column="7"
                            Width="40" Height="40"
                            Margin="4,0"
                            Background="Transparent"
                            BorderThickness="0"
                            Style="{StaticResource DockIconStyle}"
                            Click="TrashIcon_Click"
                            ToolTip="Recycle Bin">
                        <Border CornerRadius="8" ClipToBounds="True">
                            <Image x:Name="RecycleBinIcon"
                                   Width="40" Height="40"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   RenderTransformOrigin="0.5,0.5">
                                <Image.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </Image.RenderTransform>
                            </Image>
                        </Border>
                        <Button.Triggers>
                            <EventTrigger RoutedEvent="MouseEnter">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="RecycleBinIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                       To="1.1" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="RecycleBinIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                       To="1.1" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <EventTrigger RoutedEvent="MouseLeave">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="RecycleBinIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleX"
                                                       To="1.0" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <DoubleAnimation Storyboard.TargetName="RecycleBinIcon"
                                                       Storyboard.TargetProperty="RenderTransform.ScaleY"
                                                       To="1.0" Duration="0:0:0.12">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Button.Triggers>
                    </Button>
                        </Grid>
            </Border>
            
            <!-- Dock Shadow for depth -->
            <Border x:Name="DockShadow"
                    Height="60"
                    VerticalAlignment="Bottom"
                    HorizontalAlignment="Center"
                    CornerRadius="16"
                    MinWidth="320"
                    Margin="0,0,0,6"
                    Panel.ZIndex="-1">
                <Border.Effect>
                    <DropShadowEffect Color="Black" 
                                      BlurRadius="25" 
                                      ShadowDepth="4" 
                                      Opacity="0.4"/>
                </Border.Effect>
            </Border>
        </Grid>
        
        <!-- Dock Hidden State Indicator -->
        <Border x:Name="DockIndicator"
                Width="60" Height="4"
                Background="#40FFFFFF"
                CornerRadius="2"
                VerticalAlignment="Bottom"
                HorizontalAlignment="Center"
                Margin="0,0,0,8"
                Visibility="Collapsed"/>
    </Grid>
</UserControl>