<UserControl x:Class="SeroDesk.Views.ModernTaskbar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SeroDesk.Views"
             mc:Ignorable="d" 
             Height="48"
             d:DesignWidth="1920">
    
    <Grid>
        <Border Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource SubtleBrush}"
                BorderThickness="0,1,0,0">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" 
                                ShadowDepth="-2" 
                                Opacity="0.3"
                                Direction="90"/>
            </Border.Effect>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/> <!-- Start Button -->
                    <ColumnDefinition Width="Auto"/> <!-- Quick Launch -->
                    <ColumnDefinition Width="*"/>    <!-- Running Apps -->
                    <ColumnDefinition Width="Auto"/> <!-- System Tray -->
                </Grid.ColumnDefinitions>
                
                <!-- Start Button -->
                <Button Grid.Column="0"
                        x:Name="StartButton"
                        Width="48" Height="48"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="StartButton_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="Border"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="8">
                                <Grid>
                                    <Path x:Name="StartIcon"
                                          Data="M4,4 L12,4 L12,12 L4,12 Z M14,4 L22,4 L22,12 L14,12 Z M4,14 L12,14 L12,22 L4,22 Z M14,14 L22,14 L22,22 L14,22 Z"
                                          Fill="{DynamicResource AccentBrush}"
                                          Stretch="Uniform"
                                          Width="20" Height="20"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"/>
                                </Grid>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="#20FFFFFF"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="#30FFFFFF"/>
                                    <Setter TargetName="StartIcon" Property="RenderTransform">
                                        <Setter.Value>
                                            <ScaleTransform ScaleX="0.9" ScaleY="0.9" CenterX="10" CenterY="10"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                
                <!-- Quick Launch Area -->
                <StackPanel Grid.Column="1" 
                           Orientation="Horizontal"
                           Margin="8,0">
                    <ItemsControl x:Name="QuickLaunchItems"
                                ItemsSource="{Binding QuickLaunchApps}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Width="40" Height="40"
                                        Margin="2"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        ToolTip="{Binding Name}"
                                        Click="QuickLaunchButton_Click"
                                        Tag="{Binding}">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="Border"
                                                    Background="{TemplateBinding Background}"
                                                    CornerRadius="4">
                                                <Image Source="{Binding IconImage}"
                                                       Width="24" Height="24"
                                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#20FFFFFF"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
                
                <!-- Running Applications -->
                <ScrollViewer Grid.Column="2"
                             VerticalScrollBarVisibility="Disabled"
                             HorizontalScrollBarVisibility="Auto"
                             PanningMode="HorizontalOnly">
                    <ItemsControl x:Name="RunningAppsControl"
                                ItemsSource="{Binding RunningApplications}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <local:TaskbarButton AppWindow="{Binding}"
                                                   Width="200"
                                                   Height="40"
                                                   Margin="2"
                                                   Click="TaskbarButton_Click"
                                                   MouseEnter="TaskbarButton_MouseEnter"
                                                   MouseLeave="TaskbarButton_MouseLeave"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                
                <!-- System Tray -->
                <StackPanel Grid.Column="3" 
                           Orientation="Horizontal"
                           Margin="8,0">
                    
                    <!-- Network Icon -->
                    <Button x:Name="NetworkButton"
                            Width="32" Height="32"
                            Background="Transparent"
                            BorderThickness="0"
                            ToolTip="Network">
                        <Path Data="M12,2 C6.48,2 2,6.48 2,12 C2,17.52 6.48,22 12,22 C17.52,22 22,17.52 22,12 C22,6.48 17.52,2 12,2 Z M11,19.93 C7.05,19.44 4,16.08 4,12 C4,11.38 4.08,10.79 4.21,10.21 L9,15 L9,16 C9,17.1 9.9,18 11,18 L11,19.93 Z M17.9,17.39 C17.64,16.58 16.9,16 16,16 L15,16 L15,13 C15,12.45 14.55,12 14,12 L8,12 L8,10 L10,10 C10.55,10 11,9.55 11,9 L11,7 L13,7 C14.1,7 15,6.1 15,5 L15,4.59 C17.93,5.78 20,8.65 20,12 C20,14.08 19.2,15.97 17.9,17.39 Z"
                              Fill="{DynamicResource ForegroundBrush}"
                              Stretch="Uniform"
                              Width="16" Height="16"/>
                    </Button>
                    
                    <!-- Volume Icon -->
                    <Button x:Name="VolumeButton"
                            Width="32" Height="32"
                            Background="Transparent"
                            BorderThickness="0"
                            ToolTip="Volume">
                        <Path Data="M3,9 L3,15 L7,15 L12,20 L12,4 L7,9 L3,9 Z M16.5,12 C16.5,10.23 15.48,8.71 14,7.97 L14,16.02 C15.48,15.29 16.5,13.77 16.5,12 Z M14,3.23 L14,5.29 C16.89,6.15 19,8.83 19,12 C19,15.17 16.89,17.85 14,18.71 L14,20.77 C18.01,19.86 21,16.28 21,12 C21,7.72 18.01,4.14 14,3.23 Z"
                              Fill="{DynamicResource ForegroundBrush}"
                              Stretch="Uniform"
                              Width="16" Height="16"/>
                    </Button>
                    
                    <!-- Clock -->
                    <TextBlock x:Name="ClockText"
                              VerticalAlignment="Center"
                              Foreground="{DynamicResource ForegroundBrush}"
                              FontSize="14"
                              Margin="8,0"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Window Preview Popup -->
        <Popup x:Name="PreviewPopup"
               PlacementTarget="{Binding ElementName=RunningAppsControl}"
               Placement="Top"
               AllowsTransparency="True"
               PopupAnimation="Fade"
               StaysOpen="False">
            <Border Background="{DynamicResource SurfaceBrush}"
                    BorderBrush="{DynamicResource SubtleBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Margin="10">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" Opacity="0.3"/>
                </Border.Effect>
                
                <Grid>
                    <Image x:Name="PreviewImage"
                           Width="300"
                           Height="200"
                           Stretch="Uniform"
                           Margin="8"/>
                    
                    <!-- DWM Thumbnail Host -->
                    <Border x:Name="ThumbnailHost"
                            Width="300"
                            Height="200"
                            Margin="8"
                            Background="Transparent"/>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</UserControl>